
; PICBASIC PRO(TM) Compiler 2.50a, (c) 1998, 2007 microEngineering Labs, Inc. All Rights Reserved.  
PM_USED			EQU	1

	INCLUDE	"16F887.INC"


; Define statements.
#define		CODE_SIZE		 8
#define		ADC_BITS		 8
#define		ADC_CLOCK		 3
#define		ADC_SAMPLEUS		 50
#define		LCD_DREG		 PORTC   
#define		LCD_DBIT		 4       
#define		LCD_RSREG		 PORTC  
#define		LCD_RSBIT		 3      
#define		LCD_EREG		 PORTC
#define		LCD_EBIT		 2
#define		LCD_RWREG		 PORTE
#define		LCD_RWBIT		 2
#define		LCD_BITS		 4
#define		LCD_LINES		 2
#define		LCD_COMMANDUS		 2000
#define		LCD_DATAUS		 50
#define		OSC		 4

RAM_START       		EQU	00020h
RAM_END         		EQU	001EFh
RAM_BANKS       		EQU	00004h
BANK0_START     		EQU	00020h
BANK0_END       		EQU	0007Fh
BANK1_START     		EQU	000A0h
BANK1_END       		EQU	000EFh
BANK2_START     		EQU	00110h
BANK2_END       		EQU	0016Fh
BANK3_START     		EQU	00190h
BANK3_END       		EQU	001EFh
EEPROM_START    		EQU	02100h
EEPROM_END      		EQU	021FFh

R0              		EQU	RAM_START + 000h
R1              		EQU	RAM_START + 002h
R2              		EQU	RAM_START + 004h
R3              		EQU	RAM_START + 006h
R4              		EQU	RAM_START + 008h
R5              		EQU	RAM_START + 00Ah
R6              		EQU	RAM_START + 00Ch
R7              		EQU	RAM_START + 00Eh
R8              		EQU	RAM_START + 010h
FLAGS           		EQU	RAM_START + 012h
GOP             		EQU	RAM_START + 013h
RM1             		EQU	RAM_START + 014h
RM2             		EQU	RAM_START + 015h
RR1             		EQU	RAM_START + 016h
RR2             		EQU	RAM_START + 017h
T1              		EQU	RAM_START + 018h
T2              		EQU	RAM_START + 01Ah
T3              		EQU	RAM_START + 01Ch
T4              		EQU	RAM_START + 01Eh
_WFdiff          		EQU	RAM_START + 020h
_WLdiff          		EQU	RAM_START + 022h
_C               		EQU	RAM_START + 024h
_F               		EQU	RAM_START + 025h
_Fdiff           		EQU	RAM_START + 026h
_Fprev           		EQU	RAM_START + 027h
_i               		EQU	RAM_START + 028h
_n               		EQU	RAM_START + 029h
_num             		EQU	RAM_START + 02Ah
_theOne          		EQU	RAM_START + 02Bh
_WF              		EQU	RAM_START + 02Ch
_WFprev          		EQU	RAM_START + 02Dh
_WL              		EQU	RAM_START + 02Eh
_WLprev          		EQU	RAM_START + 02Fh
_PORTL           		EQU	 PORTB
_PORTH           		EQU	 PORTC
_TRISL           		EQU	 TRISB
_TRISH           		EQU	 TRISC
#define _PORTD??0        	 PORTD, 000h
	INCLUDE	"OPTIMU~1.MAC"
	INCLUDE	"PBPPIC14.LIB"

	MOVE?CB	0C0h, ADCON0
	MOVE?CB	0FFh, TRISA
	MOVE?CB	000h, TRISB
	MOVE?CB	001h, TRISD
	MOVE?CB	000h, _C
	MOVE?CB	000h, _num
	MOVE?CB	000h, _n
	MOVE?CB	000h, _i
	MOVE?CB	014h, _theOne

	LABEL?L	_Main	
	GOSUB?L	_getSensors
	CMPNE?BCL	_num, 000h, L00001
	LABEL?L	L00003	
	CMPGE?WCL	_WLdiff, 078h, L00004
	GOSUB?L	_getSensors
	GOSUB?L	_wallEcho
	GOTO?L	L00003
	LABEL?L	L00004	
	MOVE?CB	001h, _num
	LABEL?L	L00001	
	CMPNE?TCL	_PORTD??0, 000h, L00005
	GOSUB?L	_getSensors
	ADD?BCB	_C, 001h, _C
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	04Ch
	LCDOUT?C	069h
	LCDOUT?C	06Eh
	LCDOUT?C	065h
	CMPNE?BCL	_C, 001h, L00007
	LABEL?L	L00009	
	CMPGT?WCB	_WFdiff, 046h, T1
	CMPLT?BCB	_WFprev, 03Ch, T2
	LOR?BBW	T1, T2, T2
	CMPGT?BCB	_WF, 02Ah, T3
	LOR?WBW	T2, T3, T3
	CMPLT?BCB	_WF, 022h, T4
	LOR?WBW	T3, T4, T4
	CMPF?WL	T4, L00010
	GOSUB?L	_getSensors
	CMPGE?BCL	_F, 0B9h, L00011
	GOSUB?L	_gotoRoom
	LABEL?L	L00011	
	GOSUB?L	_turnRight
	GOTO?L	L00009
	LABEL?L	L00010	
	MOVE?CB	002h, _C
	LABEL?L	L00013	
	CMPLE?BCL	_WF, 00Fh, L00014
	GOSUB?L	_getSensors
	GOSUB?L	_chargeForward
	GOTO?L	L00013
	LABEL?L	L00014	
	LABEL?L	L00015	
	CMPGT?BCB	_WL, 00Ah, T1
	CMPLT?BCB	_WF, 023h, T2
	LOR?BBW	T1, T2, T2
	CMPF?WL	T2, L00016
	GOSUB?L	_getSensors
	GOSUB?L	_turnRight
	GOTO?L	L00015
	LABEL?L	L00016	
	LABEL?L	L00017	
	CMPGE?BCL	_WL, 01Eh, L00018
	GOSUB?L	_chargeForward
	GOSUB?L	_getSensors
	GOTO?L	L00017
	LABEL?L	L00018	
	LABEL?L	L00019	
	CMPLE?BCL	_WF, 028h, L00020
	GOSUB?L	_getSensors
	GOSUB?L	_turnLeft
	GOTO?L	L00019
	LABEL?L	L00020	
	LABEL?L	L00021	
	CMPGE?BCL	_WF, 046h, L00022
	GOSUB?L	_getSensors
	GOSUB?L	_turnLeft
	ADD?BCB	_i, 001h, _i
	GOTO?L	L00021
	LABEL?L	L00022	
	CMPGE?BCL	_F, 0D2h, L00023
	GOSUB?L	_gotoRoom
	LABEL?L	L00023	
	MOVE?CB	003h, _C
	MOVE?CB	000h, _n
	LABEL?L	L00025	
	MUL?BCW	_i, 004h, T1
	CMPGT?BWL	_n, T1, L00026
	GOSUB?L	_getSensors
	GOSUB?L	_turnRight
	NEXT?BCL	_n, 001h, L00025
	LABEL?L	L00026	
	LABEL?L	L00027	
	CMPLE?BCL	_WL, 00Fh, L00028
	GOSUB?L	_getSensors
	GOSUB?L	_chargeForward
	GOTO?L	L00027
	LABEL?L	L00028	
	LABEL?L	L00029	
	CMPNE?TCL	_PORTD??0, 001h, L00030
	GOSUB?L	_getSensors
	GOSUB?L	_wallStick
	GOTO?L	L00029
	LABEL?L	L00030	
	LABEL?L	L00007	
	CMPNE?BCL	_C, 003h, L00031
	GOSUB?L	_flameGet
	LABEL?L	L00031	
	LABEL?L	L00005	
	GOSUB?L	_wallStick
	GOTO?L	_Main

	LABEL?L	_getSensors	
	MOVE?BB	_WL, _WLprev
	MOVE?BB	_WF, _WFprev
	MOVE?BB	_F, _Fprev
	MOVE?CB	000h, ADCON1
	ADCIN?CB	000h, _F
	ADCIN?CB	001h, _WL
	ADCIN?CB	002h, _WF
	SUB?BCW	_WL, 003h, T1
	DIV?CWW	01A83h, T1, T1
	SUB?WCW	T1, 004h, T1
	DIV?WCB	T1, 005h, _WL
	SUB?BCW	_WF, 003h, T1
	DIV?CWW	01A83h, T1, T1
	SUB?WCW	T1, 004h, T1
	DIV?WCB	T1, 005h, _WF
	SUB?BBW	_WL, _WLprev, T1
	ADD?WCW	T1, 064h, _WLdiff
	SUB?BBW	_WF, _WFprev, T1
	ADD?WCW	T1, 064h, _WFdiff
	SUB?BBW	_F, _Fprev, T1
	ADD?WCB	T1, 064h, _Fdiff
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	LCDOUT?C	046h
	LCDOUTD?B	_WF
	LCDOUT?C	0FEh
	LCDOUT?C	014h
	LCDOUT?C	04Ch
	LCDOUTD?B	_WL
	LCDOUT?C	0FEh
	LCDOUT?C	014h
	LCDOUT?C	046h
	LCDOUTD?B	_F
	LCDOUT?C	0FEh
	LCDOUT?C	014h
	LCDOUT?C	052h
	LCDOUTD?B	_C
	RETURN?	

	LABEL?L	_check	
	MOVE?CB	000h, PORTB
	PAUSE?C	001F4h
	RETURN?	

	LABEL?L	_chargeForward	
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	043h
	LCDOUT?C	068h
	LCDOUT?C	061h
	LCDOUT?C	072h
	LCDOUT?C	067h
	LCDOUT?C	065h
	MOVE?CB	005h, PORTB
	PAUSE?C	001h
	RETURN?	

	LABEL?L	_turnRight	
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	009h, PORTB
	PAUSE?C	014h
	RETURN?	

	LABEL?L	_turnLeft	
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	04Ch
	LCDOUT?C	065h
	LCDOUT?C	066h
	LCDOUT?C	074h
	MOVE?CB	006h, PORTB
	PAUSE?C	014h
	RETURN?	

	LABEL?L	_wallEcho	
	CMPGE?BCL	_WL, 00Ah, L00033
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	001h, PORTB
	PAUSE?C	013h
	MOVE?CB	005h, PORTB
	PAUSE?C	001h
	LABEL?L	L00033	
	CMPLE?BCL	_WL, 00Ch, L00035
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	04Ch
	LCDOUT?C	065h
	LCDOUT?C	066h
	LCDOUT?C	074h
	MOVE?CB	004h, PORTB
	PAUSE?C	013h
	MOVE?CB	005h, PORTB
	PAUSE?C	001h
	LABEL?L	L00035	
	CMPEQ?BCB	_WL, 00Ah, T1
	CMPEQ?BCB	_WL, 00Bh, T2
	LOR?BBW	T1, T2, T2
	CMPEQ?BCB	_WL, 00Ch, T3
	LOR?WBW	T2, T3, T3
	CMPF?WL	T3, L00037
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	053h
	LCDOUT?C	074h
	LCDOUT?C	072h
	LCDOUT?C	061h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	005h, PORTB
	PAUSE?C	014h
	LABEL?L	L00037	
	RETURN?	

	LABEL?L	_wallStick	
	CMPGE?BCL	_WF, 00Dh, L00039
	LABEL?L	L00041	
	CMPGE?BCL	_WF, 032h, L00042
	GOSUB?L	_getSensors
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	009h, PORTB
	PAUSE?C	014h
	GOTO?L	L00041
	LABEL?L	L00042	
	LABEL?L	L00039	
	CMPEQ?BCB	_WL, 00Ah, T1
	CMPEQ?BCB	_WL, 00Bh, T2
	LOR?BBW	T1, T2, T2
	CMPEQ?BCB	_WL, 00Ch, T3
	LOR?WBW	T2, T3, T3
	CMPF?WL	T3, L00043
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	053h
	LCDOUT?C	074h
	LCDOUT?C	072h
	LCDOUT?C	061h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	005h, PORTB
	PAUSE?C	014h
	LABEL?L	L00043	
	CMPGE?BCL	_WL, 00Ah, L00045
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	001h, PORTB
	PAUSE?C	027h
	MOVE?CB	005h, PORTB
	PAUSE?C	001h
	LABEL?L	L00045	
	CMPLE?BCL	_WL, 00Ch, L00047
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	04Ch
	LCDOUT?C	065h
	LCDOUT?C	066h
	LCDOUT?C	074h
	MOVE?CB	004h, PORTB
	PAUSE?C	027h
	MOVE?CB	005h, PORTB
	PAUSE?C	001h
	LABEL?L	L00047	
	RETURN?	

	LABEL?L	_gotoRoom	
	GOSUB?L	_check
	GOSUB?L	_getSensors
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	046h
	LCDOUT?C	06Ch
	LCDOUT?C	061h
	LCDOUT?C	06Dh
	LCDOUT?C	065h
	LABEL?L	L00049	
	CMPGT?BCB	_WF, 014h, T1
	CMPGT?BCB	_WL, 00Ch, T2
	LAND?BBW	T1, T2, T2
	CMPF?WL	T2, L00050
	GOSUB?L	_getSensors
	GOSUB?L	_chargeForward
	GOTO?L	L00049
	LABEL?L	L00050	
	GOSUB?L	_check
	CMPGE?BCL	_C, 003h, L00051
	LABEL?L	L00053	
	CMPGT?BCB	_F, 014h, T1
	CMPGT?BCB	_WF, 00Eh, T2
	LOR?BBW	T1, T2, T2
	CMPF?WL	T2, L00054
	GOSUB?L	_getSensors
	CMPGE?BCL	_WF, 00Fh, L00055
	LABEL?L	L00057	
	CMPGE?BCL	_WF, 032h, L00058
	GOSUB?L	_getSensors
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	0F9h, PORTB
	PAUSE?C	014h
	GOTO?L	L00057
	LABEL?L	L00058	
	LABEL?L	L00055	
	CMPEQ?BCB	_WL, 00Ah, T1
	CMPEQ?BCB	_WL, 00Bh, T2
	LOR?BBW	T1, T2, T2
	CMPEQ?BCB	_WL, 00Ch, T3
	LOR?WBW	T2, T3, T3
	CMPF?WL	T3, L00059
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	053h
	LCDOUT?C	074h
	LCDOUT?C	072h
	LCDOUT?C	061h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	0F5h, PORTB
	PAUSE?C	014h
	LABEL?L	L00059	
	CMPGE?BCL	_WL, 00Ah, L00061
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	0F1h, PORTB
	PAUSE?C	005h
	MOVE?CB	0F5h, PORTB
	PAUSE?C	014h
	LABEL?L	L00061	
	CMPLE?BCL	_WL, 00Ch, L00063
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	04Ch
	LCDOUT?C	065h
	LCDOUT?C	066h
	LCDOUT?C	074h
	MOVE?CB	0F4h, PORTB
	PAUSE?C	005h
	MOVE?CB	0F5h, PORTB
	PAUSE?C	014h
	LABEL?L	L00063	
	GOTO?L	L00053
	LABEL?L	L00054	
	LABEL?L	L00051	
	CMPNE?BCL	_C, 003h, L00065
	LABEL?L	L00067	
	CMPNE?TCL	_PORTD??0, 001h, L00068
	GOSUB?L	_getSensors
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	04Ch
	LCDOUT?C	065h
	LCDOUT?C	066h
	LCDOUT?C	074h
	LCDOUT?C	06Fh
	MOVE?CB	0F4h, PORTB
	PAUSE?C	005h
	MOVE?CB	0F5h, PORTB
	PAUSE?C	00Ch
	GOTO?L	L00067
	LABEL?L	L00068	
	LABEL?L	L00065	
	GOSUB?L	_flameGet
	RETURN?	

	LABEL?L	_flameGet	
	CMPNE?BCL	_C, 003h, L00069
	MOVE?CB	005h, _theOne
	LABEL?L	L00069	
	LABEL?L	L00071	
	CMPLE?BBL	_F, _theOne, L00072
	GOSUB?L	_getSensors
	GOSUB?L	_turnRight
	GOTO?L	L00071
	LABEL?L	L00072	
	LABEL?L	L00073	
	CMPLE?BCL	_WF, 014h, L00074
	GOSUB?L	_getSensors
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	053h
	LCDOUT?C	074h
	LCDOUT?C	072h
	LCDOUT?C	061h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	005h, PORTB
	PAUSE?C	014h
	GOTO?L	L00073
	LABEL?L	L00074	
	CMPGE?BCL	_F, 014h, L00075
	LABEL?L	L00077	
	CMPLT?WCB	_WFdiff, 064h, T1
	CMPGT?BCB	_F, 005h, T2
	LOR?BBW	T1, T2, T2
	CMPF?WL	T2, L00078
	GOSUB?L	_getSensors
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	LCDOUT?C	052h
	LCDOUT?C	069h
	LCDOUT?C	067h
	LCDOUT?C	068h
	LCDOUT?C	074h
	MOVE?CB	0F9h, PORTB
	PAUSE?C	014h
	GOTO?L	L00077
	LABEL?L	L00078	
	LABEL?L	L00075	
	MOVE?CB	0F0h, PORTB
	PAUSE?C	001F4h
	GOSUB?L	_flameGet

	END
